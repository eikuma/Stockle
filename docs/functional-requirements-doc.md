# 記事保存アプリ - 機能要件定義書

## 1. 概要

本アプリケーションは、ユーザーが後で読みたい記事を保存し、効率的に管理・消費できるようにするWebアプリケーションです。AI技術を活用した要約生成とポッドキャスト作成機能により、忙しいユーザーでも効率的に情報収集が可能になります。

## 2. Phase 1: MVP機能要件

### 2.1 記事保存機能

#### 2.1.1 URL入力による保存

**入力**
- 記事のURL（HTTPおよびHTTPS対応）

**処理**
- URLの妥当性チェック
  - 正しいURL形式であることの確認
  - アクセス可能性の確認（404エラー等のチェック）
- 記事コンテンツの取得
  - タイトル
  - 本文（HTMLタグ除去済みのプレーンテキスト）
  - サムネイル画像URL
  - 公開日時
  - 著者情報（取得可能な場合）
- 重複URLチェック
  - 既に保存済みの場合は警告表示
  - ユーザーに上書き保存の選択肢を提供
- メタデータの抽出
  - OGP（Open Graph Protocol）情報
  - meta description
  - サイト名

**出力**
- 保存成功/失敗の通知
- 保存した記事の詳細画面への遷移オプション

#### 2.1.2 保存記事の永続化

- 記事本文のテキスト保存（最大100KB）
- サムネイル画像のURL保存
- 保存日時の自動記録
- 元記事URLの保持
- 記事のハッシュ値生成（更新検知用）

### 2.2 AI要約生成機能

#### 2.2.1 自動要約生成

**トリガー**
- 記事保存完了時に自動実行
- 手動での再生成も可能

**処理**
- 記事本文から要約生成
  - 文字数: 200-300文字
  - 主要なポイントを3-5個抽出
- 要約の品質チェック
  - 最低文字数（150文字）の確認
  - 記事の主要キーワード含有チェック
- 生成失敗時の処理
  - 最大3回までリトライ
  - 失敗時は記事の冒頭部分を要約として使用

**保存内容**
- 要約テキスト
- 生成日時
- 使用したAIモデル情報
- 生成ステータス（成功/失敗/代替）

### 2.3 カテゴリ自動分類機能

#### 2.3.1 事前定義カテゴリ

**デフォルトカテゴリ**
- テクノロジー
- ビジネス
- エンターテインメント
- ライフスタイル
- ニュース
- 学術・研究
- その他

**カテゴリ管理**
- ユーザーによるカテゴリ追加（最大20個）
- カテゴリ名の編集
- カテゴリの削除（記事は「その他」に移動）
- カテゴリの並び順変更

#### 2.3.2 自動分類処理

**分類基準**
- タイトルと本文のキーワード分析
- 記事のメタデータ活用（存在する場合）
- AIによる内容理解と分類
- ドメイン情報による補助的分類

**信頼度スコア**
- 分類の確信度を0-100%で算出
- 50%未満の場合は「その他」に分類
- ユーザーによる手動での分類変更可能

### 2.4 記事管理機能

#### 2.4.1 既読/未読管理

**ステータス定義**
- **未読**: デフォルト状態（新規保存時）
- **既読**: 記事詳細ページを3秒以上表示で自動マーク
- **お気に入り**: ユーザーが手動でマーク（Phase 2で実装予定）

**操作機能**
- ワンクリックでの既読/未読切り替え
- 複数選択による一括ステータス変更
- 「すべて既読にする」機能

#### 2.4.2 記事一覧表示

**表示項目**
- タイトル（最大60文字、超過時は省略表示）
- 要約（最初の100文字を表示）
- サムネイル画像（ない場合はデフォルト画像）
- 保存日時（相対時間表示: 「3時間前」等）
- カテゴリバッジ
- 既読/未読インジケーター

**表示オプション**
- グリッドビュー / リストビュー切り替え
- 1ページあたりの表示件数（10/20/50件）
- 無限スクロール対応

**並び順オプション**
- 保存日時（新しい順/古い順）
- タイトル（昇順/降順）
- 未読優先表示
- カテゴリ別グループ表示

#### 2.4.3 記事詳細表示

**表示内容**
- 記事タイトル（全文表示）
- 完全な要約
- 元記事へのリンク（新規タブで開く）
- カテゴリ情報（変更可能）
- 保存日時
- 記事の公開日時（取得できた場合）
- 削除ボタン

**自動処理**
- 既読ステータスへの自動更新
- 閲覧履歴の記録

### 2.5 検索機能

#### 2.5.1 検索対象

- タイトル（部分一致、大文字小文字区別なし）
- 要約（部分一致、大文字小文字区別なし）
- カテゴリ（完全一致）
- URL（ドメイン名での検索も可能）

#### 2.5.2 検索オプション

**フィルター機能**
- 既読/未読でのフィルタリング
- カテゴリでの絞り込み（複数選択可）
- 保存日時の範囲指定
  - 今日
  - 過去7日間
  - 過去30日間
  - カスタム期間

**検索結果**
- 検索キーワードのハイライト表示
- 検索結果件数の表示
- 検索条件のクリア機能

### 2.6 ユーザー管理機能

#### 2.6.1 認証機能

**2.6.1.1 メールアドレス認証**
- メールアドレス + パスワードによるログイン
- パスワード要件
  - 最小8文字
  - 英数字を含む
- アカウント作成時のメール検証
- パスワードリセット機能
  - リセットリンクの有効期限: 1時間
  - 使用後のリンク無効化

**2.6.1.2 Googleアカウント認証（OAuth 2.0）**
- Googleアカウントでのワンクリックログイン
- 初回ログイン時の処理
  - 自動アカウント作成
  - プロフィール情報の取得
- 必要な権限スコープ
  - email（メールアドレス取得）
  - profile（名前、プロフィール画像取得）
- 認証エラー時の処理
  - エラーメッセージの表示
  - メールアドレス認証へのフォールバック

**2.6.1.3 アカウント統合**
- 同一メールアドレスでの統合
  - 両認証方法でのログイン可能
  - 既存アカウントへの認証方法追加
- 認証方法の管理
  - 現在の認証方法の表示
  - Google連携の追加/解除

**2.6.1.4 セッション管理**
- セッション有効期限
  - デフォルト: 7日間
  - 「Remember me」有効時: 30日間
- セキュリティ機能
  - 複数デバイスでの同時ログイン対応
  - アクティブセッション一覧表示
  - 全デバイス一括ログアウト

#### 2.6.2 ユーザー設定

**プロフィール管理**
- 表示名（最大50文字）
- プロフィール画像
  - Googleアカウントから取得
  - デフォルトアバター
- メールアドレス（変更時は再検証必要）

**アプリケーション設定**
- デフォルトカテゴリの設定
- 表示設定
  - 1ページの表示件数
  - デフォルトの並び順
  - ビューモード（グリッド/リスト）
- 通知設定（Phase 2で実装予定）

**アカウント管理**
- パスワード変更
- 連携サービス管理
- アカウント削除
  - 削除確認プロセス
  - データの完全削除

## 3. 非機能要件

### 3.1 パフォーマンス要件

- **記事保存**: 10秒以内で完了（要約生成を除く）
- **要約生成**: 30秒以内で完了
- **ページ読み込み**: 3秒以内（初回読み込み）
- **検索処理**: 2秒以内で結果表示
- **同時接続**: 100ユーザーまで対応

### 3.2 セキュリティ要件

**通信セキュリティ**
- HTTPS通信の強制
- HSTS（HTTP Strict Transport Security）の有効化

**アプリケーションセキュリティ**
- SQLインジェクション対策
- XSS（Cross-Site Scripting）対策
- CSRF（Cross-Site Request Forgery）対策
- セキュアなセッション管理

**認証・認可**
- パスワードのハッシュ化（bcrypt、コスト係数12）
- OAuth 2.0の安全な実装
- Rate Limiting（API呼び出し制限）

### 3.3 可用性要件

- **稼働率**: 99%以上（月間約7時間のダウンタイム許容）
- **バックアップ**: 
  - データベース: 日次バックアップ
  - 保持期間: 7日間
- **災害復旧**: 24時間以内の復旧目標

### 3.4 互換性要件

**ブラウザサポート**
- Chrome（最新2バージョン）
- Firefox（最新2バージョン）
- Safari（最新2バージョン）
- Edge（最新2バージョン）

**デバイス対応**
- レスポンシブデザイン
- 最小画面幅: 320px
- タッチデバイス対応

### 3.5 制約事項

**システム制限**
- 1ユーザーあたりの保存記事数: 1,000件
- 1記事あたりの本文サイズ: 100KB
- アップロード画像サイズ: 5MB（将来実装時）
- API呼び出し: 100回/分/ユーザー

**コンテンツ制限**
- 違法コンテンツの保存禁止
- 著作権保護されたコンテンツの取り扱い注意

## 4. Phase 2: 音声対応機能

### 4.1 ポッドキャスト生成機能

#### 4.1.1 音声ファイル生成

**自動生成トリガー**
- 記事保存時にバックグラウンドで生成
- ユーザーによる手動生成リクエスト
- 要約更新時の再生成

**音声生成仕様**
- 入力: 記事要約テキスト（200-300文字）
- 音声形式: MP3（128kbps）
- 音声の特性:
  - 読み上げ速度: 標準（調整可能）
  - 音声の種類: 男性/女性/中性から選択可能
  - 言語: 日本語（将来的に多言語対応）
- ファイルサイズ: 最大5MB
- 生成時間: 最大60秒

**メタデータ**
- タイトル（記事タイトルから自動設定）
- 説明文（要約の最初の50文字）
- 生成日時
- 再生時間

#### 4.1.2 音声プレイヤー機能

**基本再生機能**
- 再生/一時停止
- シークバー（任意の位置への移動）
- 音量調整（0-100%）
- 再生時間表示（現在時間/総時間）

**高度な再生機能**
- **再生速度調整**
  - 0.5x, 0.75x, 1.0x, 1.25x, 1.5x, 1.75x, 2.0x
  - カスタム速度設定（0.5x-3.0x）
- **10秒スキップ**（前後）
- **A-Bリピート機能**
- **スリープタイマー**
  - 15分, 30分, 45分, 60分, カスタム設定

#### 4.1.3 バックグラウンド再生

**対応環境**
- モバイルブラウザでの画面オフ時再生
- 他のタブ/アプリ使用時の継続再生
- 通知からの再生コントロール

**再生状態の保持**
- 最後に再生した位置の記憶
- アプリ再起動時の復元
- 複数デバイス間での同期

#### 4.1.4 プレイリスト機能

**プレイリスト作成**
- 名前とdescriptionの設定
- 記事の追加/削除/並び替え
- 自動プレイリスト生成:
  - カテゴリ別
  - 未読記事
  - 今週の記事
  - ランダム選択

**プレイリスト再生**
- 連続再生
- シャッフル再生
- リピート設定（1曲/全曲）
- 次の曲/前の曲への移動

**プレイリスト管理**
- 最大50個のプレイリスト作成
- プレイリストの複製
- 再生履歴（最近再生した50件）
- お気に入りプレイリスト

### 4.2 音声関連の追加機能

#### 4.2.1 ダウンロード機能
- 個別音声ファイルのダウンロード
- プレイリスト一括ダウンロード（ZIP形式）
- オフライン再生対応

#### 4.2.2 音声カスタマイズ
- イコライザー設定（プリセット5種類）
- 無音部分の自動スキップ
- BGM追加オプション（将来実装）

## 7. 技術要件

### 7.1 Phase 2 技術要件

**音声処理**
- Text-to-Speech APIの選定（コスト重視）
- 音声ファイルのCDN配信
- ストリーミング再生対応
- Web Audio APIの活用

**パフォーマンス**
- 音声生成: 記事保存後3分以内
- 音声ファイルキャッシング
- プログレッシブダウンロード

### 7.2 Phase 3 技術要件

**AI/機械学習**
- ベクトル化エンジン（記事類似度計算）
- 自然言語処理（タグ抽出）
- クラスタリングアルゴリズム

**データ分析**
- リアルタイム分析パイプライン
- 時系列データの効率的な保存
- 集計処理の最適化

### 7.3 Phase 4 技術要件

**スケーラビリティ**
- バッチ処理システム（ダイジェスト生成）
- 推薦システムのキャッシング戦略
- 非同期処理の拡張

**外部連携**
- Webhook システム
- メール配信サービス統合
- API レート制限管理

## 8. データ要件の拡張

### 8.1 Phase 2 追加データ

**音声データ**
- 音声ファイルURL
- 再生時間
- ファイルサイズ
- 生成ステータス
- 音声設定（速度、音声タイプ）

**再生履歴**
- 再生開始/終了時刻
- 再生位置
- 再生完了率

### 8.2 Phase 3 追加データ

**記事関連性**
- 類似度マトリックス
- グループID
- グループ内順位

**読書行動データ**
- ページ滞在時間
- スクロール深度
- インタラクション（クリック、ハイライト）
- 読書セッション情報

### 8.3 Phase 4 追加データ

**ユーザー嗜好モデル**
- 興味スコア（カテゴリ別）
- 読書時間帯パターン
- 推薦フィードバック履歴

**自動化ルール**
- 条件式
- アクション定義
- 実行履歴
- 効果測定データ

## 9. セキュリティ要件の拡張

### 9.1 Phase 2-4 共通

**データ保護**
- 音声ファイルのアクセス制御
- 個人の読書履歴の暗号化
- 推薦データの匿名化

**プライバシー**
- 読書行動データの利用同意
- データエクスポート機能
- アカウント削除時の完全消去

**コンプライアンス**
- GDPR対応（EU圏ユーザー）
- 著作権配慮（要約・音声生成）

## 10. 運用要件

### 10.1 監視

**システム監視**
- API応答時間
- エラー率
- リソース使用率
- 音声生成キューの長さ

**ビジネスメトリクス**
- DAU/MAU
- 記事保存数
- 音声再生率
- 機能利用率

### 10.2 保守

**定期メンテナンス**
- データベース最適化
- 古い音声ファイルのアーカイブ
- ログローテーション
- セキュリティパッチ適用

**障害対応**
- 障害検知アラート
- 自動フェイルオーバー
- バックアップからの復旧手順

## 11. 移行計画

### 11.1 Phase間の移行

**データ移行**
- スキーマ変更時の移行スクリプト
- ダウンタイムなしの移行
- ロールバック計画

**機能追加時の考慮事項**
- 後方互換性の維持
- 段階的ロールアウト
- A/Bテストの実施

## 12. Phase 3: スマート機能

### 5.1 類似記事グルーピング機能

#### 5.1.1 類似度計算

**分析対象**
- タイトルの意味的類似度
- 本文内容の類似度（TF-IDF、Word2Vec）
- カテゴリの一致度
- 保存時期の近さ
- 参照元ドメインの一致

**類似度スコア**
- 0-100%のスコアで表示
- 閾値設定（デフォルト: 70%以上を類似と判定）
- ユーザーによる閾値カスタマイズ

#### 5.1.2 グループ表示

**グループ化ルール**
- 同一トピックの記事を自動グループ化
- グループ名の自動生成（共通キーワードから）
- 手動でのグループ作成/編集

**UI表示**
- グループ単位での折りたたみ表示
- グループ内の記事数表示
- グループの代表記事（最新or最も関連性が高い）
- グループ一括操作（既読、削除、カテゴリ変更）

### 5.2 ブックマークレット機能

#### 5.2.1 実装仕様

**インストール方法**
- ドラッグ&ドロップでブックマークバーに追加
- ワンクリックインストールボタン
- モバイル向けの代替方法提供

**動作仕様**
- 現在閲覧中のページ情報を取得
- ポップアップウィンドウで保存確認
- カテゴリ選択オプション
- 保存成功/失敗の通知

**セキュリティ**
- HTTPS必須
- CSP（Content Security Policy）対応
- クロスオリジン制限の適切な処理

### 5.3 高度なタグ機能

#### 5.3.1 タグシステム

**タグの種類**
- 自動生成タグ（AIによるキーワード抽出）
- ユーザー定義タグ
- システムタグ（#未読, #重要, #要確認）

**タグ管理**
- タグの追加/削除（記事あたり最大10個）
- タグの一括編集
- タグのマージ機能
- タグの使用頻度表示

**タグクラウド**
- 使用頻度によるサイズ変更
- クリックでフィルタリング
- 期間別のトレンドタグ表示

### 5.4 読書統計・分析機能

#### 5.4.1 基本統計

**読書時間の追跡**
- 記事ごとの閲覧時間記録
- 実際の読書時間vs推定読書時間
- スクロール位置の追跡
- 読了率の計算

**統計ダッシュボード**
- 日/週/月/年単位の統計表示
- 総読書時間
- 読了記事数
- 平均読書速度（文字/分）
- 最も読んだカテゴリ/タグ

#### 5.4.2 詳細レポート

**読書傾向分析**
- 時間帯別の読書パターン
- 曜日別の読書量
- カテゴリ別の滞在時間
- 読了率の高い/低い記事の特徴分析

**可視化**
- 折れ線グラフ（読書時間の推移）
- 円グラフ（カテゴリ別割合）
- ヒートマップ（読書活動カレンダー）
- バーチャート（タグ別記事数）

**エクスポート機能**
- CSV形式でのデータ出力
- PDFレポート生成
- 共有用URLの生成

## 6. Phase 4: 自動化・効率化機能

### 6.1 ダイジェスト配信機能

#### 6.1.1 ダイジェスト生成

**配信タイミング設定**
- 毎日（時刻指定）
- 週次（曜日と時刻指定）
- 月次（日付と時刻指定）
- カスタムスケジュール

**ダイジェスト内容**
- 未読記事の要約（最大10件）
- カテゴリ別のサマリー
- 読書統計（前回配信からの変化）
- おすすめ記事（読書傾向に基づく）

**配信形式**
- メール配信
  - HTMLメール（リッチフォーマット）
  - プレーンテキスト
- アプリ内通知
- RSS/Atomフィード
- Webhook（Slack, Discord等）

#### 6.1.2 カスタマイズオプション

**内容のカスタマイズ**
- 含めるカテゴリの選択
- 記事数の上限設定
- 要約の長さ調整
- 統計情報の表示/非表示

**配信条件**
- 最小記事数（3件以上ある場合のみ配信等）
- 特定キーワードを含む記事の優先表示
- 重要度による並び替え

### 6.2 要約の多段階対応

#### 6.2.1 要約レベル

**短縮版（Short）**
- 50-100文字
- 記事の主題のみ
- 読了時間: 10秒
- 用途: 一覧表示、通知

**標準版（Medium）**
- 200-300文字
- 主要ポイント3-5個
- 読了時間: 30秒
- 用途: デフォルト表示

**詳細版（Long）**
- 500-800文字
- 詳細な内容説明
- 章立て構造
- 読了時間: 2分
- 用途: 深い理解が必要な場合

#### 6.2.2 要約の切り替え

**UI操作**
- ワンクリックで要約レベル切り替え
- スライダーでの段階調整
- デフォルトレベルの設定

**自動選択**
- 記事の長さに応じた自動選択
- ユーザーの読書速度に基づく推奨
- 時間帯による切り替え（朝は短縮版等）

### 6.3 高度なAI分類・分析

#### 6.3.1 多次元分類

**分類軸**
- トピック（メインカテゴリ）
- 難易度（初級/中級/上級）
- 記事タイプ（ニュース/解説/オピニオン/チュートリアル）
- 感情トーン（ポジティブ/ニュートラル/ネガティブ）
- 信頼度スコア（ソースの信頼性評価）

**動的カテゴリ生成**
- ユーザーの保存パターンから新カテゴリ提案
- トレンドに基づくカテゴリ自動作成
- カテゴリの統合・分割提案

#### 6.3.2 コンテンツ分析

**重要度スコアリング**
- 個人の興味に基づくスコア（0-100）
- グローバルトレンドスコア
- 情報の新規性評価
- 関連記事との差分分析

**要点抽出の高度化**
- 記事内の重要な数値・統計の抽出
- 引用文の識別と重要度評価
- アクションアイテムの抽出
- 結論・まとめの自動識別

### 6.4 レコメンデーション機能

#### 6.4.1 推薦アルゴリズム

**協調フィルタリング**
- 類似ユーザーの読書傾向分析
- 同じ記事を読んだユーザーの他の記事
- カテゴリ横断的な推薦

**コンテンツベース推薦**
- 読了記事との内容類似度
- タグ・キーワードマッチング
- 著者・ソースの一致

**ハイブリッド推薦**
- 両手法の組み合わせ
- 時系列を考慮した重み付け
- 多様性の確保（フィルターバブル回避）

#### 6.4.2 推薦の表示と管理

**表示場所**
- ホーム画面の専用セクション
- 記事詳細ページの関連記事
- ダイジェストメールへの組み込み

**フィードバック機能**
- 推薦の評価（役立った/役立たない）
- 推薦理由の表示
- 推薦のカスタマイズ設定

### 6.5 自動化ワークフロー

#### 6.5.1 ルールベース自動化

**条件設定**
- 特定キーワードを含む記事
- 特定ドメインからの記事
- 特定の著者の記事
- 保存後の経過時間

**アクション**
- 自動カテゴリ割り当て
- 自動タグ付け
- 優先度の設定
- 自動アーカイブ/削除

#### 6.5.2 スマート通知

**通知タイミング**
- 重要記事の保存時
- 未読記事の蓄積警告
- 読書目標の進捗
- 新しい推薦記事

**通知チャネル**
- プッシュ通知
- メール通知
- アプリ内通知
- 外部サービス連携

## 5. 用語定義

- **記事**: ユーザーが保存したWebページのコンテンツ
- **要約**: AIが生成した記事の要点をまとめたテキスト
- **カテゴリ**: 記事を分類するための大分類
- **タグ**: 記事に付与する詳細な分類（Phase 3で実装）
- **ダイジェスト**: 複数の記事要約をまとめたもの